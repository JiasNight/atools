# aTools 插件协议规范 v1.0

> 🌟 **核心原则**：协议是生态的“宪法”，所有代码围绕它构建  
> 📅 最后更新：2026-01-30 | 协议状态：**稳定（Stable）**

---

## 一、为什么需要此协议？

| 问题             | 本协议解决方案                                     |
| ---------------- | -------------------------------------------------- |
| 插件随意访问系统 | **权限白名单**：安装时用户可见所有权限请求         |
| 框架升级插件失效 | **协议版本号**：`atools_protocol` 字段实现平滑迁移 |
| 插件结构混乱     | **标准目录规范**：开发者开箱即用                   |
| 安全漏洞频发     | **沙箱隔离设计**：JS插件与系统操作严格分离         |

---

## 二、plugin.json 完整规范

### ✅ 必填字段（缺失则插件加载失败）

### 🔒 权限声明（用户安装时可见）

#### 权限枚举表

| 权限字符串        | 说明             | 风险等级 | 用户提示文案              |
| ----------------- | ---------------- | -------- | ------------------------- |
| `clipboard:read`  | 读取剪贴板       | 中       | “需要读取剪贴板内容”      |
| `clipboard:write` | 写入剪贴板       | 低       | “需要写入剪贴板”          |
| `fs:read:home`    | 读取用户主目录   | 高       | “⚠️ 需要访问您的个人文件” |
| `fs:write:home`   | 写入用户主目录   | 高       | “⚠️ 需要修改您的个人文件” |
| `fs:plugin`       | 读写插件自身目录 | 低       | （默认允许，不提示）      |
| `network`         | 访问网络         | 中       | “需要联网获取数据”        |
| `window`          | 控制应用窗口     | 中       | “需要调整窗口状态”        |
| `shortcut`        | 注册全局快捷键   | 中       | “需要注册全局快捷键”      |
| `none`            | 无系统权限       | 无       | “纯本地计算，无权限请求”  |

> 💡 **安全设计**：
>
> - `fs:plugin` 为插件沙箱目录（如 `~/.atools/plugins/timestamp-converter/`），框架自动授予，**无需声明**
> - 高风险权限（`fs:read:home`等）安装时弹窗二次确认

### 🌐 entry 配置详解

| 字段      | 类型                  | 说明                                                               |
| --------- | --------------------- | ------------------------------------------------------------------ |
| `type`    | `webview` / `process` | `webview`=JS沙箱运行（推荐）；`process`=独立子进程（需高权限场景） |
| `main`    | string                | 入口文件路径（相对插件目录）                                       |
| `preload` | string                | 仅 `webview` 有效，预加载脚本（用于安全暴露受限API）               |

### 📦 完整示例（含扩展字段）

### 🔑 字段说明表

| 字段                 | 必填 | 说明                                                    |
| -------------------- | ---- | ------------------------------------------------------- |
| `name`               | ✅   | **小写字母+数字+中划线**，全局唯一（如 `qr-generator`） |
| `version`            | ✅   | 语义化版本（SemVer）                                    |
| `atools_protocol`    | ✅   | **当前仅支持 `"v1"`**，框架据此判断兼容性               |
| `min_atools_version` | ❌   | 最低框架版本要求（如 `"0.3.0"`）                        |
| `update_url`         | ❌   | 插件更新检查地址（返回最新 plugin.json）                |
| `x-*`                | ❌   | **自定义扩展字段**（框架忽略，供插件内部使用）          |

---

## 三、插件目录规范

---

## 四、安全与扩展设计

### 🔐 沙箱通信模型

### 🌱 未来扩展预留

| 字段                    | 用途           | 当前处理              |
| ----------------------- | -------------- | --------------------- |
| `atools_protocol: "v2"` | 未来协议升级   | 框架提示“插件需更新”  |
| `x-*` 开头字段          | 插件自定义配置 | 框架完全忽略          |
| `dependencies`          | 插件依赖声明   | v1 协议预留，暂不实现 |

---

## 五、验证与工具

### ✅ 本地验证命令
